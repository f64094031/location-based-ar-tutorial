<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>demo</title>
    <script src='https://aframe.io/releases/0.9.2/aframe.min.js'></script>
    <script src="https://raw.githack.com/jeromeetienne/AR.js/master/aframe/build/aframe-ar.min.js"></script>
    <script src="https://raw.githack.com/donmccurdy/aframe-extras/master/dist/aframe-extras.loaders.min.js"></script>
    <script>
        THREEx.ArToolkitContext.baseURL = 'https://raw.githack.com/jeromeetienne/ar.js/master/three.js/'
    </script>
    <link rel="stylesheet" type="text/css" href="./test.css"/>
	  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />

    <!--ArcGIS API-->
	  <link rel="stylesheet" href="https://js.arcgis.com/4.13/esri/css/main.css">
	  <script src="https://js.arcgis.com/4.13/"></script>

    <style>
		html, body {
				height: 100%;
				margin: 0;
				padding: 0;
			}
	</style>
</head>

<body style='margin: 0; overflow: hidden;'>
  
  <div id="apidata"
    onmouseover="over(this);"
		onmouseout="out(this);"
		onmousedown="down(this);"
		onmouseup="up(this);"><p>資料</p>
  </div>

<script>
	function over(elem){
		elem.style.backgroundColor="#ddaaaa";
	}
	function out(elem){
		elem.style.backgroundColor="#ffcccc";
	}
	function down(elem){
    fetch("https://data.moenv.gov.tw/api/v2/aqx_p_432?api_key=4dcde793-5890-4f3e-af67-58a652e0a1fc&filters=county,EQ,%E8%87%BA%E5%8D%97%E5%B8%82").then(function(response){
					//https://data.epa.gov.tw/api/v2/aqx_p_149?format=json&language=zh&api_key=4dcde793-5890-4f3e-af67-58a652e0a1fc
					return response.json();
				}).then(function(data){
					console.log(data);
					let one=data;
					console.log(one.records[3].status);
					document.getElementById("apidata").innerHTML ="<div>" + "測站名稱:" + one.records[3].sitename + "<br>"
                                                                + "縣市 " + one.records[3].county + "<br>"
                                                                + "空氣品質指標 " + one.records[3].aqi + "<br>" 
                                                                + "狀態 " + one.records[3].status + "<br>"
                                                                + "二氧化硫（ppb） " + one.records[3].so2 + "<br>"
                                                                + "一氧化碳（ppm） " + one.records[3].co + "<br>"
                                                                + "臭氧（ppb） " + one.records[3].o3 + "<br>"
                                                                + "臭氧8小時移動平均（ppb） " + one.records[3].o3_8hr + "<br>"
                                                                + "懸浮微粒（μg\/m3） " + one.records[3].pm10 + "<br>" 
                                                                + "細懸浮微粒（μg\/m3） " + one.records[3]["pm2.5"] + "<br>" 
                                                                + "二氧化氮（ppb） " + one.records[3]["no2"] + "<br>" 
                                                                + "氮氧化物（ppb） " + one.records[3]["nox"] + "<br>" 
                                                                + "一氧化氮（ppb） " + one.records[3]["no"] + "<br>" 
                                                                + "風速（m\/sec） " + one.records[3]["wind_speed"] + "<br>" 
                                                                + "資料發布時間 " + one.records[3]["publishtime"] + "<div>";
        });
    
	}
	function up(elem){
    getdata();
		elem.style.fontWeight="normal";
    document.getElementById("apidata").innerHTML ="<div>" + "空氣品質資料:" + one.records[3].sitename + ": " + one.records[3].status + "<div>";
	}
</script>
  
  <button class="button abc" onclick="getdata()">獲取資料</button>
  <script>
    function getdata(){
				fetch("https://data.moenv.gov.tw/api/v2/aqx_p_432?api_key=4dcde793-5890-4f3e-af67-58a652e0a1fc&filters=county,EQ,%E8%87%BA%E5%8D%97%E5%B8%82").then(function(response){
					//https://data.epa.gov.tw/api/v2/aqx_p_149?format=json&language=zh&api_key=4dcde793-5890-4f3e-af67-58a652e0a1fc
					return response.json();
				}).then(function(data){
					console.log(data);
					let one=data;
					console.log(one.records[3].status);
					document.getElementById("apidata").innerHTML ="<div>" + "空氣品質資料" + "<br>" + one.records[3].sitename + ": " + one.records[3].status + "<div>";
				});
    }
  </script>

    <a-scene
        vr-mode-ui="enabled: false"
		    embedded
        arjs='sourceType: webcam; sourceWidth:1280; sourceHeight:960; displayWidth: 1280; displayHeight: 960; debugUIEnabled: false;'>
        
        <a-assets>
            <img id = "P1" src="./pic/texture.png">
            <img id="arrow" src="./pic/arrow.png">
						<a-assets-item id="nav" src="./assets/nav/nav4.gltf"></a-assets-item>
            <a-assets-item id="articuno" src="./assets/articuno/scene.gltf"></a-assets-item>
            <a-assets-item id="dragonite" src="./assets/dragonite/scene.gltf"></a-assets-item>
        </a-assets>
        
        <a-image src="#P1" rotation="0 180 0" scale="0.15 0.15 0.15" side="double" 
          gps-entity-place="longitude: 120.220086; latitude: 22.998544;" >
        </a-image>

        <!-- <a-image src="#arrow" rotation="-90 0 0" scale="1 1 1" side="double"
          gps-entity-place="longitude: 120.217926; latitude: 23.008419;" >
        </a-image> -->

        <a-image src="#arrow" rotation="-90 90 0" scale="1 1 1" side="double"
          gps-entity-place="longitude: 120.219535; latitude: 22.998400;" 
          width="2" 
          height="40" 			                
			    repeat = "1 30" >
        </a-image> 

        <a-image src="#arrow" rotation="-90 90 0" scale="1 1 1" side="double"
          gps-entity-place="longitude: 120.219994; latitude: 22.998558;" >
        </a-image> 

        <a-image src="#arrow" rotation="-90 90 0" scale="1 1 1" side="double"
          gps-entity-place="longitude: 120.219986; latitude: 22.998477;" >
        </a-image> 

        <a-image src="#arrow" rotation="-90 90 0" scale="1 1 1" side="double"
          gps-entity-place="longitude: 120.219975; latitude: 22.998373;" >
        </a-image> 

        <a-image src="#arrow" rotation="-90 0 0" scale="1 1 1" side="double"
          gps-entity-place="longitude: 120.219881; latitude: 22.998383;" >
        </a-image>

        <a-image src="#arrow" rotation="-90 0 0" scale="1 1 1" side="double"
          gps-entity-place="longitude: 120.219795; latitude: 22.998388;" >
        </a-image>

        <a-image src="#arrow" rotation="-90 0 0" scale="1 1 1" side="double"
          gps-entity-place="longitude: 120.219704; latitude: 22.998394;" >
        </a-image> 

        <a-image src="#arrow" rotation="-90 0 0" scale="1 1 1" side="double"
          gps-entity-place="longitude: 120.219611; latitude: 22.998401;" >
        </a-image> 
        
        <a-image src="#arrow" rotation="-90 0 0" scale="1 1 1" side="double"
          gps-entity-place="longitude: 120.219519; latitude: 22.998406;" >
        </a-image> 

        <a-image src="#arrow" rotation="-90 0 0" scale="1 1 1" side="double"
          gps-entity-place="longitude: 120.219422; latitude: 22.998411;" >
        </a-image> 

        <a-image src="#arrow" rotation="-90 0 0" scale="1 1 1" side="double"
          gps-entity-place="longitude: 120.219318; latitude: 22.998416;" >
        </a-image> 

        <a-image src="#arrow" rotation="-90 0 0" scale="1 1 1" side="double"
          gps-entity-place="longitude: 120.219212; latitude: 22.998425;" >
        </a-image>

        <a-image src="#arrow" rotation="-90 0 0" scale="1 1 1" side="double"
          gps-entity-place="longitude: 120.219087; latitude: 22.998432;" >
        </a-image>

        <a-image src="#arrow" rotation="-90 0 0" scale="1 1 1" side="double"
          gps-entity-place="longitude: 120.218917; latitude: 22.998405;" >
        </a-image>

        <a-image src="#arrow" rotation="-90 0 0" scale="1 1 1" side="double"
          gps-entity-place="longitude: 120.218719; latitude: 22.998419;" >
        </a-image>

        <a-image src="#arrow" rotation="-90 0 0" scale="1 1 1" side="double"
          gps-entity-place="longitude: 120.218523; latitude: 22.998437;" >
        </a-image>
        
        <!--副館館前-->
        <!-- <a-plane 
            gps-entity-place="longitude: 120.219270; latitude: 22.998821;" 
            scale="1 1 1" 
		        rotation="90 0 -90"
			      width="2" height="40" 
			      color="#FFFFFF"
            src="#arrow"
			      repeat = "1 30" 
            side="double">
        <a-plane 
            gps-entity-place="longitude: 120.219657; latitude: 22.998797;"   
            scale="1 1 1" 
		        rotation="0 0 -89"
			      width="2" height="40" 
			      color="#0000AA"
            src="#arrow"
			      repeat = "1 30" 
            side="double">
            </a-plane>
		    </a-plane> -->

        <!--家前-->
        <a-entity 
          gltf-model="#nav" 
          scale="1 1 1"
          gps-entity-place="longitude: 120.217959; latitude: 23.008352;"></a-entity>
        </a-entity>

        <a-entity 
          gltf-model="#nav" 
          scale="1 1 1"
          gps-entity-place="longitude: 120.219635; latitude: 22.998484;"></a-entity>


      </a-entity>

        <!--position="-14.5 15 0"-->
        <!--不能以中文字-->
        <a-text 
          value="My home"
          side="double"
          gps-entity-place="longitude: 120.217975; latitude: 23.008345;">
        </a-text>

        <a-text 
          value="Kaiyuan Elementary School" 
          side="double"
          gps-entity-place="longitude: 120.217901; latitude: 23.008287;">
        </a-text>
         
        <a-text 
          value="geomatics" 
          color="#0000AA"
          scale="15 15 15"
          side="double"
          gps-entity-place="longitude: 120.2199187; latitude: 22.9988631;">
        </a-text>

        <a-text 
          value="geomatics2" 
          color="#00AA00"
          scale="10 10 10"
          side="double"
          gps-entity-place="longitude: 120.219265; latitude: 22.998846;">
        </a-text>

        <a-text 
          value="Department of MATH" 
          scale="5 5 5"
          color="#AAAAAA"
          side="double"
          gps-entity-place="longitude: 120.2189759; latitude: 22.9986366;">
        </a-text>

        <a-text 
          value="Department of Civil Engineering" 
          color="#AA0000"
          scale="10 10 10"
          side="double" 
					rotation="0 -90 0"
          gps-entity-place="longitude: 120.2198716; latitude: 22.9992252;">
        </a-text>

        <a-entity 
          gltf-model="#articuno" 
          scale="0.05 0.05 0.05"
          gps-entity-place="longitude: 120.220013; latitude: 22.998374;">
        </a-entity>

        <a-camera gps-camera rotation-reader></a-camera>
	</a-scene>

  <div id="viewDiv"></div>
	  <script>  
		require([
		  "esri/Map",
		  "esri/views/MapView",      
		  "esri/Graphic",
		  "esri/tasks/RouteTask",
		  "esri/tasks/support/RouteParameters",
		  "esri/tasks/support/FeatureSet"
		], function(Map, MapView, Graphic, RouteTask, RouteParameters, FeatureSet) {

		  var map = new Map({
			basemap: "streets-navigation-vector"
		  });
		  
		  var view = new MapView({
			container: "viewDiv",
			map: map,
			center: [120.220061,22.998489],
			zoom: 16
		  });
		  
		  // To allow access to the route service and prevent the user from signing in, do the Challenge step in the lab to set up a service proxy
		  
		  var routeTask = new RouteTask({
			//需要登入
			//url: "https://utility.arcgis.com/usrsvcs/appservices/B6oRUZRf1bhrzrxF/rest/services/World/Route/NAServer/Route_World"
			//不用登入
			url: "https://utility.arcgis.com/usrsvcs/appservices/s1Y0qg8DGC9UdGsf/rest/services/World/Route/NAServer/Route_World/solve"
		  });

		  view.on("click", function(event){
			if (view.graphics.length === 0) {
			  addGraphic("start", event.mapPoint);
			} else if (view.graphics.length === 1) {
			  addGraphic("finish", event.mapPoint);
			  // Call the route service
			  getRoute();
			} else {
			  view.graphics.removeAll();
			  addGraphic("start",event.mapPoint);
			}
		  });
		  
		  function addGraphic(type, point) {
			var graphic = new Graphic({
			  symbol: {
				type: "simple-marker",
				color: (type === "start") ? "white" : "black",
				size: "8px"
			  },
			  geometry: point
			});
			view.graphics.add(graphic);
		  }
		
		  function getRoute() {
			// Setup the route parameters
			var routeParams = new RouteParameters({
			  stops: new FeatureSet({
				features: view.graphics.toArray()
			  }),
			  returnDirections: true
			});
			// Get the route
			routeTask.solve(routeParams).then(function(data) {
			  data.routeResults.forEach(function(result) {
				result.route.symbol = {
				  type: "simple-line",
				  color: [5, 150, 255],
				  width: 3
				};
				view.graphics.add(result.route); 
			  });
			  
			});
		  }
		  
		});
	  </script>
</body>
</html>